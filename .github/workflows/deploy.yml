name: Deploy

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'

      - name: å®‰è£…ä¾èµ–
        run: npm ci

      - name: æ„å»ºé¡¹ç›®
        run: npm run build
        env:
          MONGODB_URI: ${{ secrets.MONGODB_URI }}
          NEXTAUTH_SECRET: ${{ secrets.NEXTAUTH_SECRET }}
          NEXTAUTH_URL: ${{ secrets.NEXTAUTH_URL }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GOOGLE_CLIENT_ID: ${{ secrets.GOOGLE_CLIENT_ID }}
          GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}

      - name: éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
        run: |
          echo "ğŸš€ æ„å»ºå®Œæˆï¼"
          echo "ğŸ“¦ æ„å»ºäº§ç‰©ä½äº .next ç›®å½•"
          echo ""
          echo "ğŸ’¡ æç¤ºï¼š"
          echo "   1. å¦‚æœä½ ä½¿ç”¨ Railway/Render/Fly.io ç­‰å¹³å°ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æ„å»ºäº§ç‰©"
          echo "   2. å¦‚æœä½ ä½¿ç”¨è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éƒ¨ç½²ï¼š"
          echo "      npm run build"
          echo "      npm start"
          echo "   3. æˆ–è€…ä½¿ç”¨ Docker å®¹å™¨åŒ–éƒ¨ç½²"

      # å¦‚æœä½ ä½¿ç”¨ç‰¹å®šçš„éƒ¨ç½²å¹³å°ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç›¸åº”çš„æ­¥éª¤
      # ä¾‹å¦‚ï¼šRailway, Render, Fly.io, æˆ–è€…é€šè¿‡ SSH éƒ¨ç½²åˆ°è‡ªå·±çš„æœåŠ¡å™¨

      # ç¤ºä¾‹ï¼šéƒ¨ç½²åˆ° Railway (å¦‚æœä½¿ç”¨ Railway CLI)
      # - name: éƒ¨ç½²åˆ° Railway
      #   run: |
      #     npm install -g @railway/cli
      #     railway up

      # ç¤ºä¾‹ï¼šé€šè¿‡ SSH éƒ¨ç½²åˆ°æœåŠ¡å™¨
      # - name: éƒ¨ç½²åˆ°æœåŠ¡å™¨
      #   uses: appleboy/ssh-action@master
      #   with:
      #     host: ${{ secrets.HOST }}
      #     username: ${{ secrets.USERNAME }}
      #     key: ${{ secrets.SSH_KEY }}
      #     script: |
      #       cd /path/to/your/app
      #       git pull
      #       npm ci
      #       npm run build
      #       pm2 restart your-app-name

